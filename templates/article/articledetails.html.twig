
{% extends 'base.html.twig' %}

{% block title %}Magasin du Jardinage{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <script src="https://cdn.tiny.cloud/1/pxp2qxs4kqtox2m98ofkx07u03id6klpmsebx1w0ubgpmifr/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
        tinymce.init({
            selector: '.content'
        });
    </script>
{% endblock %}

{% block content %}
    <div class="row mt-5">
        <div class="col-md-12"><h1> {{ article.label }}</h1></div>
        <div class="col-md-6">
            <img src="/uploads/{{ article.image }}" alt="{{ article.image }}">
        </div>
        <div class="col-md-6 addToCard">
            <p class="ml-5">{{ article.price }}€</p>
            <a class="btn btn-secondary btn-lg" href="{{ path('addToCart', {'slug': article.slug, 'quantity': 1}) }}">Ajouter au panier</a>
        </div>
        <div class="col-md-12">
            <h5 style="text-transform: none">Description</h5>
            <p>{{ article.description }}</p>
            <div id='calendar'></div>
        </div>
    </div>

    <div class="bg-default border mt-3 p-3">
        <h2>Commentaires:</h2>

        {% for comment in comments %}
            <div class="bg-default border mt-0 p-2">
                <div class="row align-items-center">
                    <div class="col-sm-4 text-center">
                        {% if comment.user != null %}
                            <p>{{ comment.user.username }} </p>
                        {% else %}
                            {% if comment.anonyme %}
                                <p>Anonyme</p>
                            {% else %}
                                <p>{{ comment.userComment.username }} </p>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="col-sm-8">
                        <p>Message posté le {{ comment.date | date("d/m/Y") }} à {{ comment.date | date("H:i:s") }} par
                            {% if comment.user != null %}
                                {{ comment.user.username }}
                            {% else %}
                                {% if comment.anonyme %}
                                    Anonyme
                                {% else %}
                                    {{ comment.userComment.username }}
                                {% endif %}
                            {% endif %}
                        </p>
                        <div class="border bg-white p-2">
                            {{ comment.content | raw }}
                        </div>
                    </div>
                </div>
                {% for answer in comment.answers %}
                    <div class="row">
                        <div class="col-sm-4"></div>
                        <div class="col-sm-2 text-center">
                            {% if answer.user != null %}
                                <p>{{ answer.user.username }} </p>
                            {% else %}
                                {% if answer.anonyme %}
                                    <p>Anonyme</p>
                                {% else %}
                                    <p>{{ answer.userComment.username }} </p>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="col-sm-6">
                            <p>Message posté le {{ answer.date | date("d/m/Y") }} à {{ answer.date | date("H:i:s") }} par
                                {% if answer.user != null %}
                                    {{ answer.user.username }}
                                {% else %}
                                    {% if answer.anonyme %}
                                        Anonyme
                                    {% else %}
                                        {{ answer.userComment.username }}
                                    {% endif %}
                                {% endif %}
                            </p>
                            <div class="border bg-white p-2">
                                {{ answer.content | raw }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <div class="row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm">
                        <form class="m-0" method="post" action="{{ path('answerComment', {'slug': article.slug, 'commentStr': comment.id}) }}">
                            <div class="row">
                                <div class="col-sm">
                                    <div class="form-group">
                                        <input type="email" class="form-control" id="email" name="email" placeholder="Email">
                                    </div>
                                </div>
                                <div class="col-sm togglebutton">
                                    <label>
                                        <input type="hidden" name="anonyme" value="no">
                                        <input id="anonyme" name="anonyme" type="checkbox" value="yes" checked="" onchange="refresh()">
                                        <span class="toggle"></span>
                                        <span class="text-dark">Ecrire un message anonymement ?</span>
                                    </label>
                                </div>
                            </div>
                            <div id="info" class="row d-none">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="username" name="username" placeholder="Pseudonyme">
                                    </div>
                                </div>
                            </div>
                            <textarea class="d-none content" name="content" id="content-{{ comment.id }}"></textarea>
                            <div class="row">
                                <div class="col-sm">
                                    <div class="form-group">
                                        <input class="btn btn-primary" type="submit" value="Envoyer">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}

        <h4>Nouveau commentaire:</h4>
        <form class="m-0" method="post" action="{{ path('newComment', {'slug': article.slug}) }}">
            <div class="row">
                <div class="col-sm">
                    <input type="text" class="form-control" id="title" name="title" placeholder="Titre">
                </div>
            </div>
            <div class="row">
                <div class="col-sm">
                    <div class="form-group">
                        <input type="email" class="form-control" id="email" name="email" placeholder="Email">
                    </div>
                </div>
                <div class="col-sm togglebutton">
                    <label>
                        <input type="hidden" name="anonyme" value="no">
                        <input id="anonyme" name="anonyme" type="checkbox" value="yes" checked="" onchange="refresh()">
                        <span class="toggle"></span>
                        <span class="text-dark">Ecrire un message anonymement ?</span>
                    </label>
                </div>
            </div>
            <div id="info" class="row d-none">
                <div class="col-sm-6">
                    <div class="form-group">
                        <input type="text" class="form-control" id="username" name="username" placeholder="Pseudonyme">
                    </div>
                </div>
            </div>
            <textarea class="d-none content" name="content" id="content"></textarea>
            <div class="row">
                <div class="col-sm">
                    <div class="form-group">
                        <input class="btn btn-primary" type="submit" value="Envoyer">
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        let editors = ['#editor'];
        {% for comment in comments %}
            editors.push('#editor-{{ comment.id }}');
        {% endfor %}

        for (let editor of editors)
        {
            new Quill(editor, {
                theme: 'snow',
                placeholder: 'Contenu du sujet'
            });
        }

        function refresh() {
            let info = document.getElementById("info");
            info.classList.toggle("d-none", document.getElementById("anonyme").checked)
            if (document.getElementById("anonyme").checked) {
                document.getElementById("anonyme").value = "on";
            } else {
                document.getElementById("anonyme").value = "off";
            }
        }

    </script>

{% endblock %}

{% block javascripts %}
   {{ parent() }}

<script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>
{% endblock %}