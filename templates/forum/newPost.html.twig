{% extends 'base.html.twig' %}

{% block title %}Hello ForumController!{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}

    <div class="bg-white">
        <p class="bg-success p-2 text-white rounded">
            {% set nb = 0 %}
            {% for category in parents | reverse %}
                {% set nb = nb + 1 %}
                {% if nb == 1 %}
                    <a class="text-white" href="{{ path('forum') }}">{{ category.title }}</a>
                {% else %}
                    <a class="text-white"
                       href="{{ path('showCategory') }}/{{ category.id }}">{{ category.title }}</a>
                {% endif %}
                {% if nb < parents.count %}
                    >
                {% endif %}
            {% endfor %}
        </p>

        <h4 class="bg-success p-2 text-white text-center rounded-top mb-0">Ajouter un post</h4>

        <div class="bg-default border mt-0 p-3">
            <form class="m-0" method="post" action="{{ path('newPost', {'category': parents.get(0).id}) }}" onsubmit="processQuill()">
                <div class="row">
                    <div class="col-sm">
                        <input type="text" class="form-control" id="title" name="title" placeholder="Titre">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm">
                        <div class="form-group">
                            <input type="email" class="form-control" id="email" name="email" placeholder="Email">
                        </div>
                    </div>
                    <div class="col-sm togglebutton">
                        <label>
                            <input type="hidden" name="anonyme" value="no">
                            <input id="anonyme" name="anonyme" type="checkbox" value="yes" checked="" onchange="refresh()">
                            <span class="toggle"></span>
                            <span class="text-dark">Ecrire un message anonymement ?</span>
                        </label>
                    </div>
                </div>
                <div id="info" class="row d-none">
                    <div class="col-sm">
                        <div class="form-group">
                            <input type="text" class="form-control" id="username" name="username" placeholder="Pseudonyme">
                        </div>
                    </div>
                </div>
                <div id="editor" class="bg-white" style="min-height: 100px"></div>
                <textarea class="d-none" name="content" id="content"></textarea>
                <div class="row">
                    <div class="col-sm">
                        <div class="form-group">
                            <input class="btn btn-primary" type="submit" value="Envoyer">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            placeholder: 'Contenu du sujet'
        });

        function refresh() {
            let info = document.getElementById("info");
            info.classList.toggle("d-none", document.getElementById("anonyme").checked)
            if (document.getElementById("anonyme").checked) {
                document.getElementById("anonyme").value = "on";
            } else {
                document.getElementById("anonyme").value = "off";
            }
        }

        function processQuill() {
            let content = document.getElementById("content");
            content.innerHTML = quill.root.innerHTML;
        }

    </script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>
{% endblock %}
